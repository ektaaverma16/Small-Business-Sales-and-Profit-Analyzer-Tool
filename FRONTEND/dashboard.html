<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Dashboard | Small Business Sales & Profit Analyzer</title>

  <link rel="stylesheet" href="dashboard.css" />

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300..900&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>



  <!-- LAYOUT -->
  <div class="container">
    <div class="navigation">
      <ul>
        <!-- APP TITLE -->
        <li>
          <a href="#">
            <span class="icon"></span>
            <span class="title">Analyzer</span>
          </a>
        </li>

        <!-- BUSINESS INFO -->
        <div class="business-info">
          <div id="sidebarBusinessType"></div>
          <div id="sidebarBusinessId"></div>
        </div>

        <!-- MENU ITEMS -->
        <li>
          <a href="javascript:void(0)" onclick="showSection('dashboard')">
            <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
            <span class="title">Dashboard</span>
          </a>
        </li>
        <li class="owner-only">
          <a href="javascript:void(0)" onclick="showSection('users')">
            <span class="icon"><ion-icon name="people-outline"></ion-icon></span>
            <span class="title">Users</span>
          </a>
        </li>
        <li class="owner-only manager-only employee-only accountant-only">
          <a href="javascript:void(0)" onclick="showSection('viewSales')">
            <span class="icon"><ion-icon name="eye-outline"></ion-icon></span>
            <span class="title">View Sales</span>
          </a>
        </li>
        <li class="owner-only">
          <a href="javascript:void(0)" onclick="showSection('reports')">
            <span class="icon"><ion-icon name="stats-chart-outline"></ion-icon></span>
            <span class="title">Reports</span>
          </a>
        </li>
        <li class="owner-only manager-only accountant-only">
          <a href="javascript:void(0)" onclick="showSection('inventory')">
            <span class="icon"><ion-icon name="document-text-outline"></ion-icon></ion-icon></span>
            <span class="title">Inventory</span>
          </a>
        </li>
        <li class="employee-only">
          <a href="javascript:void(0)" onclick="showSection('addSales')">
            <span class="icon"><ion-icon name="add-outline"></ion-icon></span>
            <span class="title">Add Sales</span>
          </a>
        </li>
        <li class="employee-only">
          <a href="javascript:void(0)" onclick="showSection('myTasks')">
            <span class="icon"><ion-icon name="clipboard-outline"></ion-icon></span>
            <span class="title">My Tasks</span>
          </a>
        </li>

        <li>
          <a href="javascript:void(0)" onclick="logout()">
            <span class="icon"><ion-icon name="log-out-outline"></ion-icon></span>
            <span class="title logout">Logout</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main">
      <!-- HEADER -->
      <div class="topbar ">
        <div class="toggle"><ion-icon name="menu-outline"></ion-icon></div>
        <!-- <div class="app-name">Small Business Sales & Profit Analyzer</div> -->

        <div class="user-info">
          <span id="userName">User</span>
          <span class="role-badge" id="userRole">Role</span>
          <!-- <button class="logout-btn" onclick="logout()">Logout</button> -->
        </div>
      </div>

      <!--  BUSINESS BACKGROUND IMAGE -->
      <div class="business-bg"></div>
      <!-- ================= DASHBOARD (SAME FOR ALL) ================= -->
      <div id="dashboard" class="page-section active">
        <!-- <h2>Dashboard</h2> -->

        <!--  KPI CARDS -->
        <div class="kpi-wrapper">

          <!-- ================= OWNER & MANAGER KPIs ================= -->

          <div class="stat-card owner-only manager-only">
            <h4 class="statName">Sales Today</h4>
            <p class="stat-value" id="salesToday">‚Çπ0</p>
          </div>

          <div class="stat-card owner-only manager-only">
            <h4 class="statName">Monthly Sales</h4>
            <p class="stat-value" id="monthlySales">‚Çπ0</p>
          </div>

          <div class="stat-card owner-only manager-only">
            <h4 class="statName">Avg Order Value</h4>
            <p class="stat-value" id="avgOrderValue">‚Çπ0</p>
          </div>

          <div class="stat-card owner-only manager-only">
            <h4 class="statName">Total Revenue</h4>
            <p class="stat-value" id="totalRevenue">‚Çπ0</p>
          </div>

          <!-- ================= EMPLOYEE KPIs ================= -->

          <div class="stat-card employee-only">
            <h4 class="statName">Today's Sales</h4>
            <p class="stat-value" id="empSalesToday">‚Çπ0</p>
          </div>

          <div class="stat-card employee-only">
            <h4 class="statName">Items Sold Today</h4>
            <p class="stat-value" id="empItemsSoldToday">0</p>
          </div>

          <div class="stat-card employee-only">
            <h4 class="statName">Today's Production</h4>
            <p class="stat-value" id="empTodayProduction">0</p>
          </div>
        </div>

        <section class="production-history employee-only">
          <div class="table-header">
            <h3>My Production History</h3>
            <button id="showProductionFormBtn" class="btn btn-primary">
              ‚ûï Add New Production
            </button>
          </div>

          <table id="productionHistoryTable" class="production-table">
            <thead>
              <tr>
                <th>Batch ID</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Production Date</th>
                <th>Status</th>
                <th>Expiry Date</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <!-- JS rows go here -->
            </tbody>
          </table>

        </section>


        <!-- EDIT PRODUCTION MODAL -->
        <div id="editModal" class="modal" style="display: none">
          <div class="modal-content">
            <h3>Edit Production Batch</h3>

            <input type="hidden" id="editBatchId" />

            <label>Quantity</label>
            <input type="number" id="editQuantity" />

            <label>Notes</label>
            <textarea id="editNotes" rows="3"></textarea>

            <div class="modal-actions">
              <button class="btn-save" onclick="submitEdit()">Save</button>
              <button class="btn-cancel" onclick="closeEditModal()">Cancel</button>
            </div>
          </div>
        </div>




        <!-- ================= DAILY PRODUCTION ENTRY ================= -->
        <div id="production" class="employee-only">

          <h2>üßÅ Daily Production Entry</h2>

          <div class="card">
            <form id="productionForm">
              <div class="salesInput">

                <label>Category</label>
                <select id="prodCategory" required>
                  <option value="">Select Category</option>
                  <option value="Cakes">üç∞ Cakes</option>
                  <option value="Pastries and Desserts">üßÅ Pastries & Desserts</option>
                  <option value="Breads and Buns">ü•ê Breads & Buns</option>
                  <option value="Savory Veg Items">ü•ü Savory Veg Items</option>
                  <option value="Cookies and Tea Time">üç™ Cookies & Tea Time</option>
                </select>

                <label>Product</label>
                <select id="prodProduct" required disabled>
                  <option value="">Select Product</option>
                </select>

                <label>Quantity Produced</label>
                <input type="number" id="prodQuantity" min="1" required />

                <label>Production Date</label>
                <input type="date" id="prodDate" required />

                <label>Notes (Optional)</label>
                <input type="text" id="prodNotes" placeholder="Morning batch" />

              </div>

              <div class="buttonWrapper">
                <button type="submit" class="addSales-btn">Submit Production</button>
                <p id="prodMsg"></p>
              </div>
            </form>
          </div>

        </div>




        <!-- ================= CHARTS ================= -->

        <!-- PROFIT & LOSS BAR CHART -->
        <div class="dashboard-card owner-only manager-only chart-card">
          <h3 class="barchart">Profit vs Loss</h3>
          <div class="chart-container">
            <canvas id="profitLossChart"></canvas>
          </div>
        </div>

        <!-- MONTHLY PROFIT GRAPH -->
        <div class="dashboard-card owner-only manager-only chart-card">
          <h3 class="monthlychart"> Monthly Profit Trend</h3>
          <div class="chart-container">
            <canvas id="monthlyProfitChart"></canvas>
          </div>
        </div>

        <p id="status"></p>
      </div>


      <!-- ================= VIEW SALES ================= -->
      <div id="viewSales" class="page-section owner-only manager-only employee-only accountant-only">

        <h2>Sales List</h2>

        <table class="sales-table">
          <thead>
            <tr>
              <th>Category</th>
              <th>Product</th>
              <th>Qty</th>
              <th>Unit Price</th>
              <th>Total</th>
              <th>Sale Type</th>
              <th>Payment</th>
              <th class="empName">Added By</th>
              <th>Date</th>
              <th id="actionHeader">Action</th>
            </tr>
          </thead>

          <tbody id="salesTableBody">
            <!-- Rows injected by JS -->
          </tbody>
        </table>

        <div class="filter-container">
          <div class="filter-group">
            <label>Filter by Date</label>
            <input type="date" id="saleFilterDate">
          </div>
          <div class="filter-group">
            <label>Filter by Month</label>
            <input type="month" id="saleFilterMonth">
          </div>
          <div class="filter-actions">
            <button class="apply-filter-btn" onclick="applySalesFilter()">Apply Filter</button>
            <button class="reset-filter-btn" onclick="resetSalesFilter()">Reset</button>
          </div>
        </div>

        <p id="salesError"></p>
      </div>


      <!-- ================= ADD SALES ================= -->
      <div id="addSales" class="page-section employee-only">
        <h2>Add Sales</h2>

        <form id="addSalesForm">

          <!-- ITEM TYPE -->
          <label>Item Type</label>
          <select id="itemType" required>
            <option value="">Select Category</option>
            <option value="Cakes">üç∞ Cakes</option>
            <option value="Pastries and Desserts">üßÅ Pastries & Desserts</option>
            <option value="Breads and Buns">ü•ê Breads & Buns</option>
            <option value="Savory Veg Items">ü•ü Savory Veg Items</option>
            <option value="Cookies and Tea Time">üç™ Cookies & Tea Time</option>
          </select>

          <!-- ITEM NAME -->
          <label>Item Name</label>
          <select id="productName" required disabled>
            <option value="">Select Item</option>
          </select>

          <!-- QUANTITY -->
          <label>Quantity</label>
          <input type="number" id="quantity" min="1" required />

          <!-- UNIT PRICE -->
          <label>Unit Price (‚Çπ)</label>
          <input type="number" id="unitPrice" min="0" step="0.01" required />

          <!-- TOTAL AMOUNT -->
          <label>Total Amount (‚Çπ)</label>
          <input type="number" id="totalAmount" readonly />

          <!-- SALE TYPE -->
          <label>Sale Type</label>
          <select id="saleType" required>
            <option value="Counter Sale">Counter Sale</option>
            <option value="Online Order">Online Order</option>
            <option value="Bulk Order">Bulk Order</option>
            <option value="Custom Order">Custom Order</option>
          </select>

          <!-- PAYMENT MODE -->
          <label>Payment Mode</label>
          <select id="paymentMode" required>
            <option value="Cash">Cash</option>
            <option value="UPI">UPI</option>
            <option value="Card">Card</option>
          </select>

          <!-- SOLD BY -->
          <label>Sold By</label>
          <input type="text" id="soldBy" readonly />
          <!-- SALE DATE -->
          <label>Sale Date</label>
          <input type="date" id="saleDate" required />


          <button type="submit" class="btn-primary">Add Sale</button>

        </form>

      </div>

      <!-- ================= TASKS ================= -->
      <div id="myTasks" class="page-section employee-only">
        <h2>My Tasks</h2>
        <div class="card">
          <table class="activity-table">
            <tr>
              <th>Date</th>
              <th>Task</th>
              <th>Status</th>
            </tr>
            <tr>
              <td>13 Jan</td>
              <td>Deliver Order</td>
              <td class="success">Completed</td>
            </tr>
            <tr>
              <td>12 Jan</td>
              <td>Update Records</td>
              <td class="pending">Pending</td>
            </tr>
          </table>
        </div>
      </div>


      <!-- ================= USERS (OWNER ONLY) ================= -->
      <div id="users" class="page-section owner-only">
        <h2>All Users</h2>

        <table class="activity-table">
          <thead>
            <tr>
              <th>Username</th>
              <th>Role</th>
              <th>Business</th>
            </tr>
          </thead>
          <tbody id="usersTableBody"></tbody>
        </table>

        <p id="usersError"></p>
      </div>

      <!-- ================= INVENTORY ================= -->
      <div id="inventory" class="page-section owner-only manager-only accountant-only">
        <div class="table-header">
          <h2>Inventory</h2>
          <button class="add-stock-btn" onclick="openAddStock('')">
            ‚ûï Add Stock
          </button>
        </div>

        <table class="inventory-table">
          <thead>
            <tr>
              <th>Type</th>
              <th>Raw Material</th>
              <th>Stock</th>
              <th>Unit</th>
              <th>Min Level</th>
              <th>Unit Price</th>
              <th>Cost Price</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="inventoryTable"></tbody>
        </table>


        <!-- EDIT INVENTORY MODAL -->
        <div id="editInventoryModal" class="modal hidden">
          <div class="modal-content">
            <h3>Edit Inventory</h3>

            <input type="hidden" id="editId">

            <label>Stock Quantity</label>
            <input type="number" id="editStock">

            <label>Unit</label>
            <select id="editUnit">
              <option value="kg">kg</option>
              <option value="grams">grams</option>
              <option value="litre">litre</option>
            </select>

            <label>Minimum Stock</label>
            <input type="number" id="editMinStock">

            <label>Cost Price</label>
            <input type="number" id="editCostPrice">

            <div class="modal-actions">
              <button type="button" onclick="closeEditInventory()">Cancel</button>
              <button type="button" onclick="saveEditInventory()">Save</button>
            </div>
          </div>
        </div>


        <!-- DELETE INVENTORY MODAL -->
        <div id="deleteInventoryModal" class="modal hidden">
          <div class="modal-content">
            <h3>Delete Inventory</h3>
            <p>Are you sure you want to delete this item?</p>

            <input type="hidden" id="deleteId">

            <div class="modal-actions">
              <button type="button" onclick="closeDeleteInventory()">Cancel</button>
              <button type="button" class="danger" onclick="confirmDelete()">Delete</button>
            </div>
          </div>
        </div>

        <div id="inventoryFormWrapper" style="display: none;">

          <div class="card">
            <form id="inventoryForm">
              <div class="input-row">
                <label>Material Type</label>
                <select id="invMaterialType" required>
                  <option value="">Select Category</option>
                  <option value="üåæ Base Flours & Starches">üåæ Base Flours & Starches</option>
                  <option value="üç¨ Sweeteners">üç¨ Sweeteners</option>
                  <option value="üßà Fats & Dairy">üßà Fats & Dairy</option>
                  <option value="üß™ Leavening & Baking Agents">üß™ Leavening & Baking Agents</option>
                  <option value="üç´ Flavours & Enhancers">üç´ Flavours & Enhancers</option>
                  <option value="üå∞ Nuts & Dry Fruits">üå∞ Nuts & Dry Fruits</option>
                  <option value="üßÇ Savory Basics & Seasoning">üßÇ Savory Basics & Seasoning</option>
                  <option value="üé® Additives & Decorations">üé® Additives & Decorations</option>
                </select>

                <label>Item Name</label>
                <select id="invProduct" required disabled>
                  <option value="">Select Item</option>
                </select>

                <label>Stock Quantity</label>
                <input type="number" id="invStock" min="0" required />

                <label>Unit</label>
                <select id="invUnit" required>
                  <option value="kg">kg</option>
                  <option value="grams">grams</option>
                  <option value="litre">litre</option>
                  <option value="pcs">pcs</option>
                </select>

                <label>Minimum Stock Level</label>
                <input type="number" id="invMinStock" min="1" required />

                <label>Unit Price (‚Çπ)</label>
                <input type="number" id="invUnitPrice" min="0" step="0.01" required />

                <label>Cost Price (Total ‚Çπ)</label>
                <input type="number" id="invCost" readonly />
              </div>
              <div class="btn-row">
                <button type="submit" class="addUpdate-btn">Add / Update Stock</button>
              </div>
              <p id="invMsg"></p>
            </form>

          </div>
        </div>

      </div>



    </div>
  </div>


  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <script src="dashboard.js"></script>
  <script>
    // MenuToggle
    let toggle = document.querySelector('.toggle');
    let navigation = document.querySelector('.navigation');
    let main = document.querySelector('.main');

    toggle.onclick = function () {
      navigation.classList.toggle('active');
      main.classList.toggle('active');
    }

  </script>

</body>

</html>